(self.webpackChunktech_details=self.webpackChunktech_details||[]).push([[4824],{3905:function(t,e,a){"use strict";a.d(e,{Zo:function(){return d},kt:function(){return c}});var n=a(67294);function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function i(t,e){if(null==t)return{};var a,n,r=function(t,e){if(null==t)return{};var a,n,r={},o=Object.keys(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||(r[a]=t[a]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}var s=n.createContext({}),m=function(t){var e=n.useContext(s),a=e;return t&&(a="function"==typeof t?t(e):l(l({},e),t)),a},d=function(t){var e=m(t.components);return n.createElement(s.Provider,{value:e},t.children)},p={inlineCode:"code",wrapper:function(t){var e=t.children;return n.createElement(n.Fragment,{},e)}},u=n.forwardRef((function(t,e){var a=t.components,r=t.mdxType,o=t.originalType,s=t.parentName,d=i(t,["components","mdxType","originalType","parentName"]),u=m(a),c=r,k=u["".concat(s,".").concat(c)]||u[c]||p[c]||o;return a?n.createElement(k,l(l({ref:e},d),{},{components:a})):n.createElement(k,l({ref:e},d))}));function c(t,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var o=a.length,l=new Array(o);l[0]=u;var i={};for(var s in e)hasOwnProperty.call(e,s)&&(i[s]=e[s]);i.originalType=t,i.mdxType="string"==typeof t?t:r,l[1]=i;for(var m=2;m<o;m++)l[m]=a[m];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},51593:function(t,e,a){"use strict";a.r(e),a.d(e,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return m},toc:function(){return d},default:function(){return u}});var n=a(22122),r=a(19756),o=(a(67294),a(3905)),l=["components"],i={hide_title:!0,sidebar_label:"ROS Coordinate Systems"},s="ROS Coordinate Systems",m={unversionedId:"systems/ros-coordinate-systems",id:"systems/ros-coordinate-systems",isDocsHomePage:!1,title:"ROS Coordinate Systems",description:"Refer to ROS standard https",source:"@site/docs/systems/ros-coordinate-systems.md",sourceDirName:"systems",slug:"/systems/ros-coordinate-systems",permalink:"/tech-details/docs/systems/ros-coordinate-systems",version:"current",lastUpdatedAt:1628955083,formattedLastUpdatedAt:"8/14/2021",frontMatter:{hide_title:!0,sidebar_label:"ROS Coordinate Systems"},sidebar:"systemsSidebar",next:{title:"Unity Simulator",permalink:"/tech-details/docs/systems/unity-simulator"}},d=[{value:"Frame ID and Coordinate Frames",id:"frame-id-and-coordinate-frames",children:[{value:"From Mavros to ROS (Planning)",id:"from-mavros-to-ros-planning",children:[]},{value:"From Mavros to ROS (VIO)",id:"from-mavros-to-ros-vio",children:[]},{value:"From ROS to Mavros (VIO)",id:"from-ros-to-mavros-vio",children:[]}]},{value:"Case Study <code>/mavros/local_position</code>",id:"case-study-mavroslocal_position",children:[{value:"<code>tf</code>",id:"tf",children:[]}]}],p={toc:d};function u(t){var e=t.components,a=(0,r.Z)(t,l);return(0,o.kt)("wrapper",(0,n.Z)({},p,a,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"ros-coordinate-systems"},"ROS Coordinate Systems"),(0,o.kt)("p",null,"Refer to ROS standard ",(0,o.kt)("a",{parentName:"p",href:"https://www.ros.org/reps/rep-0103.html"},"https://www.ros.org/reps/rep-0103.html"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"For positions represented with reference to a initial body frame, FLU (NWU) should be used"),(0,o.kt)("li",{parentName:"ul"},"However, if the position represents a geographic location (either global or local), ENU should be used",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"This includes ",(0,o.kt)("inlineCode",{parentName:"li"},"/mavros/local_position"),", outputing ENU frame ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/mavlink/mavros/blob/master/mavros/src/plugins/local_position.cpp"},"Code"))))),(0,o.kt)("p",null,"Similarly, in RVIS visualisations, RGB represents the 3-axis of the coordinates in sequence. The default global coordinates is ",(0,o.kt)("inlineCode",{parentName:"p"},"map"),". This map should represent ENU aligned global position or ENU aligned local position."),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Reading from this ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/mavlink/mavros/issues/525"},"issue"),", we should note that NWU is neither a ROS standard nor a Mavros convention, when describing a location."),(0,o.kt)("p",{parentName:"div"},"However, NWU is used in sensors for example IMU for their linear acceleration and angular rates, which creates confusion, by Mavros. (Mavlink always uses NED)"))),(0,o.kt)("h2",{id:"frame-id-and-coordinate-frames"},"Frame ID and Coordinate Frames"),(0,o.kt)("p",null,"Naming convention: ",(0,o.kt)("a",{parentName:"p",href:"https://www.ros.org/reps/rep-0105.html"},"REP 105")),(0,o.kt)("p",null,"Rule of thumb: sensor data should be in NED frame (depth, VIO), global position and orientation should be in ENU frame (Motion Capture, ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/mavlink/mavros/blob/master/mavros_extras/src/plugins/mocap_pose_estimate.cpp"},"Code"),")."),(0,o.kt)("h3",{id:"from-mavros-to-ros-planning"},"From Mavros to ROS (Planning)"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Frame ID"),(0,o.kt)("th",{parentName:"tr",align:null},"Coordinate Frame"),(0,o.kt)("th",{parentName:"tr",align:null},"Remark"),(0,o.kt)("th",{parentName:"tr",align:null},"Example"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"map")),(0,o.kt)("td",{parentName:"tr",align:null},"ENU"),(0,o.kt)("td",{parentName:"tr",align:null},"True North Aligned"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/mavros/local_position/pose")," (configurable in launch file)")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"map_ned")),(0,o.kt)("td",{parentName:"tr",align:null},"NED"),(0,o.kt)("td",{parentName:"tr",align:null},"By Mavros"),(0,o.kt)("td",{parentName:"tr",align:null})),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"base_link")),(0,o.kt)("td",{parentName:"tr",align:null},"local ",(0,o.kt)("strong",{parentName:"td"},"ENU")),(0,o.kt)("td",{parentName:"tr",align:null},"INCONSISTENT"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/mavros/local_position/odom"),", and static tf sent by mavros")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"base_link_frd")),(0,o.kt)("td",{parentName:"tr",align:null},"local NED"),(0,o.kt)("td",{parentName:"tr",align:null},"By Mavros"),(0,o.kt)("td",{parentName:"tr",align:null},"Should use this as the pointcloud measurement frame")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"base_link_enu")),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},"shall we define this?")))),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/844913/92745835-fd592f80-f382-11ea-82a7-08724875e74e.png",alt:null})),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/mavlink/mavros/issues/1388"},"More Info")),(0,o.kt)("p",null,"It appears that although ROS recommand NWU as the convention for local frame, but ",(0,o.kt)("inlineCode",{parentName:"p"},"base_link")," in mavros uses ENU."),(0,o.kt)("h3",{id:"from-mavros-to-ros-vio"},"From Mavros to ROS (VIO)"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Frame ID"),(0,o.kt)("th",{parentName:"tr",align:null},"Coordinate Frame"),(0,o.kt)("th",{parentName:"tr",align:null},"Remark"),(0,o.kt)("th",{parentName:"tr",align:null},"Example"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"base_link")),(0,o.kt)("td",{parentName:"tr",align:null},"ENU"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/mavros/imu/data/orientation"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"base_link")),(0,o.kt)("td",{parentName:"tr",align:null},"local NWU"),(0,o.kt)("td",{parentName:"tr",align:null}),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/mavros/imu/data/angular_velocity"),", ",(0,o.kt)("inlineCode",{parentName:"td"},"/mavros/imu/data/linear_acceleration"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"base_link")),(0,o.kt)("td",{parentName:"tr",align:null},"local ",(0,o.kt)("strong",{parentName:"td"},"NWU")),(0,o.kt)("td",{parentName:"tr",align:null},"INCONSISTENT"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/mavros/imu/data_raw/*"))))),(0,o.kt)("h3",{id:"from-ros-to-mavros-vio"},"From ROS to Mavros (VIO)"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Frame ID"),(0,o.kt)("th",{parentName:"tr",align:null},"Coordinate Frame"),(0,o.kt)("th",{parentName:"tr",align:null},"Remark"),(0,o.kt)("th",{parentName:"tr",align:null},"Example"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"odom")),(0,o.kt)("td",{parentName:"tr",align:null},"ENU"),(0,o.kt)("td",{parentName:"tr",align:null},"True North Aligned"),(0,o.kt)("td",{parentName:"tr",align:null})),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"odome_ned")),(0,o.kt)("td",{parentName:"tr",align:null},"NED"),(0,o.kt)("td",{parentName:"tr",align:null},"By Mavros"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"/mavros/odometry/out"),' with frame_id = "odom_ned"')))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},'    // Publish helper TFs used for frame transformation in the odometry plugin\n    std::vector<geometry_msgs::TransformStamped> transform_vector;\n    add_static_transform("map", "map_ned", Eigen::Affine3d(ftf::quaternion_from_rpy(M_PI, 0, M_PI_2)),transform_vector);\n    add_static_transform("odom", "odom_ned", Eigen::Affine3d(ftf::quaternion_from_rpy(M_PI, 0, M_PI_2)),transform_vector);\n    add_static_transform("base_link", "base_link_frd", Eigen::Affine3d(ftf::quaternion_from_rpy(M_PI, 0, 0)),transform_vector);\n\n    tf2_static_broadcaster.sendTransform(transform_vector);\n')),(0,o.kt)("h2",{id:"case-study-mavroslocal_position"},"Case Study ",(0,o.kt)("inlineCode",{parentName:"h2"},"/mavros/local_position")),(0,o.kt)("p",null,"All message below assumes ",(0,o.kt)("inlineCode",{parentName:"p"},"map")," as the frame id, and the child frame id is ",(0,o.kt)("inlineCode",{parentName:"p"},"base_link"),". This means that ",(0,o.kt)("inlineCode",{parentName:"p"},"map")," is representing ENU coordinates."),(0,o.kt)("p",null,"Also, the orientation is also converted to ENU frame, which means ",(0,o.kt)("inlineCode",{parentName:"p"},"base_link")," is also in ENU frame."),(0,o.kt)("h3",{id:"tf"},(0,o.kt)("inlineCode",{parentName:"h3"},"tf")),(0,o.kt)("p",null,"The tf transformation is optionally sent by setting the parameter ",(0,o.kt)("inlineCode",{parentName:"p"},"local_position/tf/send")," to true, located at ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/mavlink/mavros/blob/master/mavros/launch/px4_config.yaml"},"px4_config.yaml")))}u.isMDXComponent=!0}}]);