(self.webpackChunktech_details=self.webpackChunktech_details||[]).push([[1907],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return u},kt:function(){return d}});var r=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var c=r.createContext({}),s=function(e){var t=r.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=s(a),d=n,h=m["".concat(c,".").concat(d)]||m[d]||p[d]||i;return a?r.createElement(h,o(o({ref:t},u),{},{components:a})):r.createElement(h,o({ref:t},u))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var s=2;s<i;s++)o[s]=a[s];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},4307:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return u},default:function(){return m}});var r=a(22122),n=a(19756),i=(a(67294),a(3905)),o=["components"],l={hide_title:!0,sidebar_label:"Calibration Procedures"},c="Calibration Procedures 123",s={unversionedId:"research/calibration/calibration-procedures",id:"research/calibration/calibration-procedures",isDocsHomePage:!1,title:"Calibration Procedures 123",description:"Cameras should ideally be mounted horizontally against a rigit blackplate, such as aluminium or acrylic. If movement of the entire mount cannot be eliminated it would then be prudent to ensure the cameras does not flex independently against each other.",source:"@site/docs/research/calibration/calibration-procedures.md",sourceDirName:"research/calibration",slug:"/research/calibration/calibration-procedures",permalink:"/tech-details/docs/research/calibration/calibration-procedures",version:"current",lastUpdatedAt:1628956952,formattedLastUpdatedAt:"8/14/2021",frontMatter:{hide_title:!0,sidebar_label:"Calibration Procedures"},sidebar:"researchSidebar",previous:{title:"Kalibr Result Conventions",permalink:"/tech-details/docs/research/calibration/kalibr-result-conventions"},next:{title:"Verify by Kalibr Validator",permalink:"/tech-details/docs/research/calibration/verify-by-kalibr-validator"}},u=[{value:"For Multi-camera calibration",id:"for-multi-camera-calibration",children:[]},{value:"Calibration of IMU-Camera(Optional)",id:"calibration-of-imu-cameraoptional",children:[]}],p={toc:u};function m(e){var t=e.components,a=(0,n.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"calibration-procedures-123"},"Calibration Procedures 123"),(0,i.kt)("p",null,"Cameras should ideally be mounted horizontally against a rigit blackplate, such as aluminium or acrylic. If movement of the entire mount cannot be eliminated it would then be prudent to ensure the cameras does not flex independently against each other."),(0,i.kt)("p",null,"VNC into ",(0,i.kt)("inlineCode",{parentName:"p"},"nvidia-desktop.local")),(0,i.kt)("h2",{id:"for-multi-camera-calibration"},"For Multi-camera calibration"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Changing the pixhawk IMU frequency")),(0,i.kt)("p",null,'On the sd card that is to be inserted into the pixhawk device:\nCreate a new folder named "etc"\nCreate a new .txt file named "extras.txt"'),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"mavlink stream -d/dev/ttyACM0 -s ATTITUDE -r 100",(0,i.kt)("br",{parentName:"p"}),"\n","mavlink stream -d/dev/ttyACM0 -s ATTITUDE",(0,i.kt)("em",{parentName:"p"},"QUATERNION -r 100",(0,i.kt)("br",{parentName:"em"}),"mavlink stream -d/dev/ttyACM0 -s HIGHRES_IMU -r 100"))),(0,i.kt)("p",null,"Save the .txt file, insert into pixhawk device, reboot device. PX4 IMU will be changed to 100Hz. Comfirm in mavlink inspector (Qgroundcontrol) or imu/data (RQT)."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Changing the trigger frequency"),"\nNavigate to Qgroundcontrol->settings->cameras"),(0,i.kt)("p",null,"Adjust the follow settings"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Triger mode: Time based always on\nTrigger interface: GPIO Time\ninterval: 250 ms\nTrigger Pin Polarity: High (3.3V)\nAUX Pin Assignment: Aux pin number")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Setting the focus of the camera."),"\nAfter mounting the cameras to the backplace, loosen the allen screw securing the lens element. Focus the camera against a target of further than 5m away."),(0,i.kt)("p",null,"Operate the viewfinder through the camera interface"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"tcam-capture\n")),(0,i.kt)("p",null,"Zoom in to focus on a far away object. Once in focus secure allen screw and ensure that the lens element is immune to loosening, as adjusting the focus of the camera after the calibration process produces undesirable results."),(0,i.kt)("p",null,"Identify the serial number of both cameras through tcam interface. "),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Before calibration"),"\nLaunch roscore"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Roscore\n")),(0,i.kt)("p",null,"Launch mavros"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"roslaunch mavros px4.launch\n")),(0,i.kt)("p",null,"Refer to device_list.yaml (catkin_ws/src/tiscamera_ros/launch/device_list.yaml).\nUpdate the camera serial number under fisheye_left, SN and fisheye_right, SN."),(0,i.kt)("p",null,"Make the edited files in the catkin folder"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"catkin make\n")),(0,i.kt)("p",null,"Launch tiscamera"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"roslaunch tiscamera_ros tiscamera_ros_drone23.launch\n")),(0,i.kt)("p",null," Launch RQT to access viewfinder during calibration"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"rqt_image_view\n")),(0,i.kt)("p",null,"Start the imaging capture by running tisbag script"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"./tisbag\n")),(0,i.kt)("p",null,"If script is unavailable:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"\n> rosbag record --lz4 /mavros/imu/data /tiscamera_ros/fisheye_left/camera_info /tiscamera_ros/fisheye_left/image_rect_raw /tiscamera_ros/fisheye_right/camera_info /tiscamera_ros/fisheye_right/image_rect_raw\n\n")),(0,i.kt)("p",null,"If the script cannot be run due to a lack of permission, permission canbe added to file"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"chmod +x tisbag\n")),(0,i.kt)("p",null,"To review the bag(optional)"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Rosbag info bagname.bag\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Recording process"),"\nOrientate the board and the camera rig such that the april5x5 target board is 2-3 meters away and fills up around 30% of the screen size. "),(0,i.kt)("p",null,"Slowly orientate the rig/board such that the big is positioned (and still fully visible) at the outer edge of the camera vision. Slowly rotate the board/camera to cover the entire circumference of the camera vision. At each position briefly tilt the angle of the board that is facing the camera."),(0,i.kt)("p",null,"Position the board/rig such that the board is in the center of the camera vision.  Slowly move the board in a circular motion to ensure maximum coverage at the center of vision. Repeat the above processes for both left and right cameras."),(0,i.kt)("p",null,"End the recording via ctrl-c.\nThe recording will be saved in a date-time.bag file."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Calibrating the cameras."),"\nIf kalibr isnt install on the computer, you can process the calibration through another terminal that has kalibr installed."),(0,i.kt)("p",null,"Update camera info in target, run-ds-none.sh with those in tisbag"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"-/tiscamera_ros/fisheye_right/image_rect_raw\n-/tiscamera_ros/fisheye_left/image_rect_raw")),(0,i.kt)("p",null,"If script is unavailable"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"kalibr_calibrate_cameras --target april_5x5.yaml --bag $1 --models\nds-none ds-none --topics /tiscamera_ros/fisheye_left/image_rect_raw\n/tiscamera_ros/fisheye_right/image_rect_raw")),(0,i.kt)("p",null," Run the tisbag script"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"}," ./run-ds-none.sh ./.bag file directory/bag-name.bag\n \n")),(0,i.kt)("p",null,"Calibration report and camchain file will be generated."),(0,i.kt)("h2",{id:"calibration-of-imu-cameraoptional"},"Calibration of IMU-Camera(Optional)"),(0,i.kt)("p",null,"This step is usually not needed, as the calibration result is generally not accurate, especially in the relative position between the IMU and the cameras."),(0,i.kt)("p",null,"It might only be useful to serve as a way to determine the mounting position and coordinate systems used in both IMU and the cameras."),(0,i.kt)("p",null,"Update the parameters inside the imu_run.sh"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"--bag <data-time.bag> --cam <camchain.date-time.yaml> --imu imu.yaml --target april_5x5.yaml\n")),(0,i.kt)("p",null,"If script is unavailable"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"#!/bin/bash\nkalibr_calibrate_imu_camera --bag $1 --cam $2 --imu $3 --target $4")))}m.isMDXComponent=!0}}]);