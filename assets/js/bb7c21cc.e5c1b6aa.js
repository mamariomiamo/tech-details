(self.webpackChunktech_details=self.webpackChunktech_details||[]).push([[5303],{3905:function(e,t,a){"use strict";a.d(t,{Zo:function(){return m},kt:function(){return d}});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},m=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=c(a),d=i,h=u["".concat(s,".").concat(d)]||u[d]||p[d]||r;return a?n.createElement(h,o(o({ref:t},m),{},{components:a})):n.createElement(h,o({ref:t},m))}));function d(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var c=2;c<r;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},62734:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return m},default:function(){return u}});var n=a(22122),i=a(19756),r=(a(67294),a(3905)),o=["components"],l={hide_title:!0,sidebar_label:"System Tuning & Configs"},s="Basalt VIO Tuning & Configs",c={unversionedId:"research/vio/basalt-tuning",id:"research/vio/basalt-tuning",isDocsHomePage:!1,title:"Basalt VIO Tuning & Configs",description:"The running of the algorithm through roslaunch, please refer to the two example files ./launch/tis23withgui.launch and ./launch/tis23.launch",source:"@site/docs/research/vio/basalt-tuning.md",sourceDirName:"research/vio",slug:"/research/vio/basalt-tuning",permalink:"/tech-details/docs/research/vio/basalt-tuning",version:"current",lastUpdatedAt:1628956952,formattedLastUpdatedAt:"8/14/2021",frontMatter:{hide_title:!0,sidebar_label:"System Tuning & Configs"},sidebar:"researchSidebar",previous:{title:"Framework Overview",permalink:"/tech-details/docs/research/vio/basalt-overview"},next:{title:"Basalt Backend (VioEstimator)",permalink:"/tech-details/docs/research/vio/basalt-backend"}},m=[{value:"Update Camera Calibration",id:"update-camera-calibration",children:[]},{value:"Tuning Basalt Configrations",id:"tuning-basalt-configrations",children:[{value:"Front End Optical Flow:",id:"front-end-optical-flow",children:[]},{value:"Back End Optimisation:",id:"back-end-optimisation",children:[]}]}],p={toc:m};function u(e){var t=e.components,a=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"basalt-vio-tuning--configs"},"Basalt VIO Tuning & Configs"),(0,r.kt)("p",null,"The running of the algorithm through ",(0,r.kt)("inlineCode",{parentName:"p"},"roslaunch"),", please refer to the two example files ",(0,r.kt)("inlineCode",{parentName:"p"},"./launch/tis_23_with_gui.launch")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"./launch/tis_23.launch")),(0,r.kt)("p",null,"It has three important parameters:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"show_gui")," to determine if the live 3D tracking is presented through GUI"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"calib_file")," to locate the basalt-specific camera-imu calibration file"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"config_path")," to locate basalt vio configurations")),(0,r.kt)("h2",{id:"update-camera-calibration"},"Update Camera Calibration"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"calib_file")," should be a ",(0,r.kt)("inlineCode",{parentName:"p"},".json")," file, typicaly located in ",(0,r.kt)("inlineCode",{parentName:"p"},"./data")," folder. It is different from Kalibr format. Therefore, a convenient python script is provided in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/chengguizi/basalt-mirror/blob/master/data/ds_kalibr_camimu.py"},"source code"),". (To run, it has scipy and sophus as dependencies)"),(0,r.kt)("p",null,"Convert the Kalibr's yaml file to json file like this"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./ds_kalibr_camimu.py camchain-imucam-2021-01-27-14-52-36.yaml tis_23\n\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"IMU-Camera Time offset")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("inlineCode",{parentName:"p"},'"cam_time_offset_ns": -1897133')," in the json file indicate the time offset in nanosecond. Meaning: imu time = camera time + cam_time_offset_ns. A negative value means image is head of imu data."))),(0,r.kt)("h2",{id:"tuning-basalt-configrations"},"Tuning Basalt Configrations"),(0,r.kt)("h3",{id:"front-end-optical-flow"},"Front End Optical Flow:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"optical_flow_epipolar_error")," could be smaller if the calibration is good, author's default is 0.01, can be as large as 0.05 if calibration is off"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"optical_flow_skip_frames")," will control how frequent the flow tracking results to be send to backend optimisation. For example, a number 2 means only have of the frames are sent to optimisation: If the camera are capturing at 20Hz, the pose output will be at 10Hz.")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Front End Debugging")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("inlineCode",{parentName:"p"},"config.feature_match_show")," could be set to true to evaluate optical flow matching performance. Connected lines means successful left-right matching"))),(0,r.kt)("h3",{id:"back-end-optimisation"},"Back End Optimisation:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"vio_max_states")," number of latest imu-pose states (shown in red in gui)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"vio_max_kfs")," number of keyframes (shown as blue in gui)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"vio_min_frames_after_kf")," the minimum frames apart, where two keyframes are taken. This is to avoid taking keyframes too frequently"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"vio_new_kf_keypoints_thresh")," the higher the threshold, the more frequent the keyframe is taken.")),(0,r.kt)("p",null,"Three more important parameters:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"vio_obs_std_dev")," the lower the standard deviation, the higher weight the back end will trust the optical flow results (hence less trust on imu prior). Typical value: 0.1 - 0.5"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"vio_obs_huber_thresh")," to bound the optical flow loss, huber loss is used. The higher the value, the more weights is put on the optical results overall. Typical value 5.0 - 1.0"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"vio_min_triangulation_dist")," this should be set just slightly smaller than the baseline of the cameras. This avoid triangulation of two frames that are physically too close in space. (Too close gives more error)")))}u.isMDXComponent=!0}}]);